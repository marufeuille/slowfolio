{{/* params:
photo, title, footer,
ratio(insta|square|l)=insta, pad(none|sm|md|lg)=md,
fit(cover|contain)=cover, focus(center|top|bottom|left|right)=center, bg(hex|css)=#fff
本文は {{< postcard ...>}} ...ここが本文... {{< /postcard>}} の .Inner で受ける
        */}}

        {{ $ph := .Get "photo" }}
        {{ $img := .Page.Resources.GetMatch $ph }}

        {{ if not $img }}
        <div class="notice">
            <strong>Image not found:</strong> {{ $ph }}<br>
            <small>画像は <code>index.md</code> と同じフォルダ（ページバンドル）に置いてください。</small>
        </div>
        {{ else }}
        {{ $ratio := .Get "ratio" | default "insta" }}
        {{ $class := cond (eq $ratio "square") "card-1200x1200" (cond (eq $ratio "l") "card-3x2" "card-1080x1350") }}
        {{ $pad := .Get "pad" | default "md" }}
        {{ $fit := .Get "fit" | default "cover" }} {{/* cover or contain */}}
        {{ $focus := .Get "focus" | default "center" }}
        {{ $bg := .Get "bg" | default "#fff" }}

        {{ $resized := $img.Fit "2000x2000" }}
        {{ $inner := .Inner | strings.TrimSpace }}
        {{ $body := cond (ne $inner "") $inner (.Get "body") }}

        <div class="card {{ $class }} pad-{{ $pad }}">
            <div class="card-photo" style="background: {{ $bg }};">
                <img loading="eager" {{/* ← lazyをやめて確実に描画 */}} src="{{ $resized.RelPermalink }}" alt=""
                    class="{{ if eq $fit " contain" }}contain{{ else }}cover{{ end }}"
                    style="object-position: {{ $focus }};">
            </div>
            <div class="card-body">
                {{ with .Get "title" }}<h2>{{ . }}</h2>{{ end }}
                {{ with $body }}{{ . | markdownify }}{{ end }} {{/* ← pを包まない。複数段・改行OK */}}
                {{ with .Get "footer" }}<div class="card-footer">{{ . }}</div>{{ end }}
            </div>
        </div>
        {{ end }}
